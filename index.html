<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ¸¸æˆä¸­å¿ƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #7b5cff 0%, #4e8cff 100%);
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            color: #222;
            margin: 0;
        }
        .header {
            color: #fff;
            text-align: center;
            padding: 48px 0 20px 0;
        }
        .header-title {
            font-size: 2.6rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .header-desc {
            font-size: 1.1rem;
            font-weight: 400;
            opacity: 0.92;
        }
        .google-login {
            position: absolute;
            top: 32px;
            right: 48px;
            display: flex;
            align-items: center;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 16px;
        }
        .search-container {
            margin: 0 auto 24px auto;
            max-width: 700px;
        }
        .search-bar {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(80,80,160,0.08);
            padding: 16px 24px;
            margin-bottom: 16px;
        }
        .search-input {
            width: 100%;
            border: none;
            font-size: 1.1rem;
            outline: none;
            background: transparent;
        }
        .category-filter {
            background: none;
            box-shadow: none;
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
        }
        .category-btn {
            background: #f3f4fa;
            color: #7b5cff;
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            font-weight: 500;
            font-size: 1rem;
            transition: background 0.2s, color 0.2s;
            cursor: pointer;
        }
        .category-btn.active, .category-btn:hover {
            background: linear-gradient(90deg, #7b5cff 0%, #4e8cff 100%);
            color: #fff;
        }
        .games-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            justify-content: center;
        }
        .game-card {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 4px 32px rgba(80,80,160,0.10);
            width: 320px;
            padding: 32px 24px 24px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
            transition: box-shadow 0.2s;
        }
        .game-card:hover {
            box-shadow: 0 8px 40px rgba(80,80,160,0.18);
        }
        .game-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 18px;
            display: block;
        }
        .game-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }
        .game-description {
            font-size: 1rem;
            color: #666;
            margin-bottom: 18px;
            text-align: center;
            min-height: 44px;
        }
        .game-meta {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 0.98rem;
            color: #888;
            margin-bottom: 18px;
        }
        .play-btn {
            background: linear-gradient(90deg, #7b5cff 0%, #4e8cff 100%);
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 12px 0;
            width: 100%;
            font-size: 1.08rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: auto;
            transition: box-shadow 0.2s, background 0.2s;
            box-shadow: 0 2px 8px rgba(80,80,160,0.10);
        }
        .play-btn:hover {
            background: linear-gradient(90deg, #4e8cff 0%, #7b5cff 100%);
            box-shadow: 0 4px 16px rgba(80,80,160,0.16);
        }
        @media (max-width: 900px) {
            .games-grid { gap: 20px; }
            .game-card { width: 95vw; max-width: 340px; }
        }
        @media (max-width: 600px) {
            .header-title { font-size: 1.5rem; }
            .container { padding: 0 4px; }
            .game-card { padding: 20px 8px 16px 8px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">
            <span style="font-size:2.2rem;">ğŸ®</span> å°æ¸¸æˆä¸­å¿ƒ
        </div>
        <div class="header-desc">å‘ç°æœ‰è¶£çš„å°æ¸¸æˆï¼Œäº«å—ä¼‘é—²æ—¶å…‰</div>
        <div class="google-login">
            <div id="g_id_onload"
                data-client_id="YOUR_GOOGLE_CLIENT_ID"
                data-callback="handleCredentialResponse"
                data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                data-type="standard"
                data-size="large"
                data-theme="outline"
                data-text="sign_in_with"
                data-shape="rectangular"
                data-logo_alignment="left">
            </div>
            <select id="lang-switch" style="margin-left:16px;padding:6px 16px;border-radius:8px;font-size:1rem;outline:none;border:1px solid #e0e0e0;vertical-align:middle;">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>
    <div class="container">
        <div class="search-container">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="è¯•è¯•'å¤ªç©ºå°„å‡»'" />
            </div>
            <div class="category-filter" id="categoryFilter"></div>
        </div>
        <div class="games-grid" id="gamesGrid">
            <!-- æ¸¸æˆå¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // æ¸¸æˆåç§°åˆ°å›¾æ ‡æ–‡ä»¶åçš„æ¨¡ç³ŠåŒ¹é…
        function getIconByTitle(title) {
            title = title.toLowerCase();
            if (title.includes('æ–¹å—') || title.includes('puzzle')) return 'icons/puzzle.svg';
            if (title.includes('è›‡') || title.includes('snake')) return 'icons/snake.svg';
            if (title.includes('å¤ªç©º') || title.includes('å°„å‡»') || title.includes('rocket') || title.includes('space')) return 'icons/rocket.svg';
            if (title.includes('æ£‹')) return 'icons/chess-knight.svg';
            if (title.includes('ç¯®çƒ')) return 'icons/basketball-ball.svg';
            if (title.includes('è¡—æœº')) return 'icons/joystick.svg';
            if (title.includes('å†œåœº')) return 'icons/farm-tractor.svg';
            return 'icons/puzzle.svg'; // é»˜è®¤
        }

        // æ¸²æŸ“æ¸¸æˆå¡ç‰‡
        function createGameCard(game) {
            const iconUrl = getIconByTitle(game.title);
            return `
                <div class="game-card">
                    <img class="game-icon" src="${iconUrl}" alt="${game.title}">
                    <h3 class="game-title">${game.title}</h3>
                    <p class="game-description">${game.description}</p>
                    <div class="game-meta">
                        <span>${game.category}</span>
                        <span>â­ ${game.rating}</span>
                    </div>
                    <button class="play-btn">ğŸ® å¼€å§‹æ¸¸æˆ</button>
                </div>
            `;
        }

        // åŠ è½½æ¸¸æˆæ•°æ®
        async function loadGames(category = 'all', search = '') {
            const lang = localStorage.getItem('language') || (navigator.language.startsWith('zh') ? 'zh' : 'en');
            const gamesGrid = document.getElementById('gamesGrid');
            gamesGrid.innerHTML = '<div style="color:#fff;">åŠ è½½ä¸­...</div>';
            try {
                const res = await fetch(`/api/games?category=${category}&search=${search}&language=${lang}`);
                const games = await res.json();
                if (!games.length) {
                    gamesGrid.innerHTML = '<div style="color:#fff;">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ¸¸æˆ</div>';
                    return;
                }
                gamesGrid.innerHTML = games.map(createGameCard).join('');
            } catch (e) {
                gamesGrid.innerHTML = '<div style="color:#fff;">åŠ è½½å¤±è´¥</div>';
            }
        }

        // æœç´¢å’Œç­›é€‰é€»è¾‘
        let currentCategory = 'all';
        let searchTimeout;
        document.querySelector('.search-input').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                loadGames(currentCategory, e.target.value);
            }, 300);
        });

        // åˆ†ç±»ä¸­è‹±æ–‡æ˜ å°„ï¼ˆåªç”¨è‹±æ–‡keyï¼Œlabelä¸ºå¯¹è±¡ï¼‰
        const categories = [
            { key: 'all', label: { zh: 'å…¨éƒ¨', en: 'All' } },
            { key: 'Puzzle', label: { zh: 'ç›Šæ™º', en: 'Puzzle' } },
            { key: 'Action', label: { zh: 'åŠ¨ä½œ', en: 'Action' } },
            { key: 'Casual', label: { zh: 'ä¼‘é—²', en: 'Casual' } },
            { key: 'Strategy', label: { zh: 'ç­–ç•¥', en: 'Strategy' } }
        ];

        // æ¸²æŸ“åˆ†ç±»æŒ‰é’®
        function renderCategoryButtons(lang, currentKey = 'all') {
            const filter = document.getElementById('categoryFilter');
            filter.innerHTML = '';
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn' + (cat.key === currentKey ? ' active' : '');
                btn.setAttribute('data-category', cat.key);
                btn.textContent = cat.label[lang];
                btn.onclick = function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = cat.key;
                    loadGames(currentCategory, document.querySelector('.search-input').value);
                };
                filter.appendChild(btn);
            });
        }

        // Google ç™»å½•å›è°ƒ
        function handleCredentialResponse(response) {
            // è¿™é‡Œå¯ä»¥å¤„ç†ç™»å½•åçš„é€»è¾‘
            console.log("Google ç™»å½•æˆåŠŸ: ", response.credential);
        }

        // è¯­è¨€åˆ‡æ¢é€»è¾‘
        function setLang(lang) {
            localStorage.setItem('language', lang);
            renderCategoryButtons(lang, currentCategory);
            window.location.reload();
        }

        // åˆå§‹åŒ–è¯­è¨€ä¸‹æ‹‰æ¡†
        document.addEventListener('DOMContentLoaded', () => {
            const browserLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
            const lang = localStorage.getItem('language') || (browserLang.startsWith('zh') ? 'zh' : 'en');
            document.getElementById('lang-switch').value = lang;
            document.getElementById('lang-switch').addEventListener('change', function() {
                setLang(this.value);
            });
            renderCategoryButtons(lang, currentCategory);
            loadGames();
        });
    </script>
</body>
</html>
